<!-- Located in:  In squarespace -> Organization Profile - > settings -> advance -->

<head>
    <meta charset="utf-8">
    <style>
      #my-map {
        width: 100%;
        height: 400px;
    }
    </style>
    <script src="//maps.googleapis.com/maps/api/js?key=AIzaSyDplsTlpTuCS-MBQggxOf0iNloTP-OBOIE"></script>
    <script>
    var home = new google.maps.LatLng(42.380753, -71.110272);
    var map;
    var _markers = [];
    var _locations = [];
    var infowindow = new google.maps.InfoWindow({
        content: ''
    });

    function addMarkerInfo(record) {
        if (record && record.geolocation && record.geolocation.length > 0) {
            var urll = "https://maps.googleapis.com/maps/api/geocode/json?address=" + record.geolocation + "&key=AIzaSyDplsTlpTuCS-MBQggxOf0iNloTP-OBOIE";
            //console.log(record.geolocation); 
            $.getJSON(urll).done(function() {
                var r = record;
                return function(data) {
                    // console.log(data.results[0].geometry.location);

                    if (data.status === google.maps.GeocoderStatus.OK) {
                        _locations.push({
                            record: r,
                            latlng: data.results[0].geometry.location
                        });
                        var v = {
                            record: r,
                            latlng: data.results[0].geometry.location
                        };
                        addMarker(v);
                    } else {
                        //   alert('Geocode was not successful for the following reason: ' + status);
                    }
                };
            }());
        }
    };

    //http://www.sciencepolicyatlas.com/collaboration?collab=-KUcyD4tJWYUpNekxX1Q
    function createMapInfoContent(data) {
        var content = '';

        if (data && data.record) {
            if (data.record.government_relations_contact_person !== undefined) {
                content = '<div id="content">' + '<div><b>' + data.record.organization_name + '</b><p>' + data.record.about + '</p>';
            } else {
                content = '<div id="content">' + '<div><b>' + data.record.organization_name + '</b><p>' + data.record.about + '</p><p><a href="http://www.sciencepolicyatlas.com/collaboration?collab=' + data.record.key + '/" target="_blank">Learn more</a>' + '</p>';
            }
        }
        return content;
    };

    function displayMap() {
        var mapOptions = {
            zoom: 10,
            // mapTypeId: 'satellite',
            center: home
        };

        map = new google.maps.Map(document.getElementById('my-map'),
            mapOptions);

        // 
        addFusionTableLayer(map);
        // testing
        //$('#atlas-iframe').css('height', '1750px');
        setTimeout(addMarkers, 3000); //200);
    }

    function addFusionTableLayer(map) {
        congressionalDistricts = new google.maps.FusionTablesLayer({
            query: {
                select: 'col5',
                from: '1QlQxBF17RR-89NCYeBmw4kFzOT3mLENp60xXAJM'
            },
            map: map
        });
    }

    function addMarkers() {
        for (var i = 0; i < _locations.length; i++) {
            var data = _locations[i];
            var title = data.organization_name;
            var infoContent = createMapInfoContent(data);
            //console.log( data.latlng.lat + ' ' + data.latlng.lng);
            var marker = new google.maps.Marker({
                position: data.latlng,
                map: map,
                title: title,
                animation: google.maps.Animation.DROP
            });

            if (i === 0) {
                map.setCenter(data.latlng);
            }

            bindContentToInfoWindow(marker, map, infowindow, infoContent);
            _markers.push(marker);
        }
    };

    function addMarker(data) {
        if (data) {
            var title = data.organization_name;
            var infoContent = createMapInfoContent(data);
            //console.log( data.latlng.lat + ' ' + data.latlng.lng);
            var marker = new google.maps.Marker({
                position: data.latlng,
                map: map,
                title: title,
                animation: google.maps.Animation.DROP
            });

            if (i === 0) {
                map.setCenter(data.latlng);
            }

            bindContentToInfoWindow(marker, map, infowindow, infoContent);
            _markers.push(marker);
        }
    }

    // binds a map marker and infoWindow together on click
    function bindContentToInfoWindow(marker, map, infowindow, infoContent) {
        google.maps.event.addListener(marker, 'click', function() {
            infowindow.setContent(infoContent);
            infowindow.open(map, marker);
        });
    };

    //function initialize() {
    //    console.log('in the view script initialize');
    // };

    // google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>

<body>
    <div>
        <h2 class="my-title" id='my-organization-name'></h2></div>
    <br>
    <hr class="styled-hr" style="width:100%;">
    <div><strong>About: </strong><span id='my-about'></span></div>
    <br>
    <div>
        <em><strong>Have feedback? See outdated information? Send a note to the&nbsp;<span id='my-manager-email'>Atlas Manager</span>.<br>This profile was last updated on <span id='my-updated-date'></span>.</strong></em>
    </div>
    <br>
    <div><strong>Location: </strong><span id="my-geolocation"></span></div>
    <div>
        <strong>Organization type: </strong>
        <span id='my-organization-category'></span>
        <span class="tooltip">(i)<span class="tooltiptext" id='my-organization-type-info'></span>
    </div>
    <div><strong>Non-profit status: </strong><span id='my-nonprofit-status'></span></div>
    <div>
        <strong>Links: </strong>
        <span id="my-website">Wesite</span><span id="my-facebook"> | Facebook</span><span id="my-twitter"> | Twitter</span><span id="my-linkedin-company-page"> | LinkedIn Company Page</span><span id="my-linkedin-groups"> | LinkedIn Groups</span>
    </div>
    <div><strong>Participation in collaborations: </strong><span id='my-collaboration-links'></span></div>
    <br>
    <div><strong>Resources: </strong><span id="my-resources"></span></div>
    <br>
    <div id="my-map"></div>
</body>
